{% extends 'base.html' %}

{% block content %}
<div class="row mb-4">
    <div class="col-md-8">
        <h1 class="display-4"><span class="text-warning">Scroll</span> of Knowledge</h1>
        <p class="lead">Latest updates from the Hidden Leaf Village.</p>
    </div>
    {% if current_user.is_authenticated and current_user.role == 'Admin' %}
    <div class="col-md-4 text-end align-self-center">
        <a href="{{ url_for('blog.create') }}" class="btn btn-warning">Write New Scroll</a>
    </div>
    {% endif %}
</div>

<div class="row">
    {% for post in posts %}
    <div class="col-md-12 mb-4">
        <div class="card h-100 bg-dark text-white border-secondary">
            <div class="card-body">
                <h2 class="card-title">{{ post.title }}</h2>
                <h6 class="card-subtitle mb-2 text-muted">
                    Written by {{ post.username }} on {{ post.created_at.strftime('%Y-%m-%d') }}
                </h6>
                <p class="card-text">{{ post.content[:200] }}...</p>
                <a href="{{ url_for('blog.post', id=post.id) }}" class="btn btn-outline-info btn-sm">Read Scroll</a>

                {% if current_user.is_authenticated and current_user.role == 'Admin' %}
                <hr>
                <div class="btn-group" role="group">
                    <a href="{{ url_for('blog.edit', id=post.id) }}" class="btn btn-warning btn-sm">Edit</a>
                    <form action="{{ url_for('blog.delete', id=post.id) }}" method="POST" class="d-inline"
                        onsubmit="return confirm('Are you sure you want to burn this scroll?');">
                        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                        <button type="submit" class="btn btn-danger btn-sm">Delete</button>
                    </form>
                </div>
                {% endif %}
            </div>
        </div>
    </div>
    {% else %}
    <div class="col-12">
        <div class="alert alert-info">No scrolls found in the archive.</div>
    </div>
    {% endfor %}
</div>
{% endblock %}
